# Portal Effects Guide

Create mesmerizing "through the looking glass" transitions using circles, doorways, and other shapes as portals between shots with AliceMultiverse's portal detection system.

## Overview

Portal effects use shapes within your shots as transition points, creating the illusion of traveling through:
- **Circles**: Tunnels, eyes, lenses, holes
- **Rectangles**: Doors, windows, screens, frames
- **Arches**: Gateways, bridges, architectural elements
- **Irregular Shapes**: Creative portals, abstract transitions

## Quick Start

### Basic Portal Detection

```bash
# Analyze two shots for portal transition
alice transitions portal doorway.jpg destination.jpg -o portal.json

# Export for After Effects
alice transitions portal shot1.jpg shot2.jpg -f after_effects -o portal.jsx

# With detailed detection info
alice transitions portal entrance.jpg exit.jpg -v
```

### Using MCP Tools in Claude

```text
User: Create a portal transition from the door shot to the room interior

Claude: I'll analyze these shots for portal transition possibilities.
[Detects portal shapes in both images]

Portal Analysis:
Shot 1: Found dark doorway (rectangle)
- Position: Center (0.50, 0.52)
- Size: 15% of frame
- Quality score: 0.89

Shot 2: Found window (rectangle)  
- Position: Right side (0.75, 0.45)
- Size: 12% of frame
- Quality score: 0.76

Best match: Doorway → Window
- Alignment: 65%
- Recommended: Portal wipe with reposition

Exported After Effects script with keyframes.
```

## Understanding Portal Detection

### What Makes a Good Portal?

1. **Clear Shape Definition**
   - Strong edges
   - Distinct from background
   - Recognizable geometry

2. **Appropriate Size**
   - 5-50% of frame area
   - Not too small (hard to see)
   - Not too large (fills frame)

3. **Visual Properties**
   - Often darker than surroundings
   - Can be lighter (bright portals)
   - Good edge contrast

### Portal Quality Score

Each portal gets a quality score based on:
- **Size** (30%): Optimal around 25% of frame
- **Darkness** (40%): How much it stands out
- **Edge Strength** (30%): How well-defined

Score interpretation:
- 0.8-1.0: Excellent portal
- 0.6-0.8: Good portal
- 0.4-0.6: Usable portal
- <0.4: Weak portal

## Portal Types

### Circles
Perfect for:
- Zoom through effects
- Spiral transitions
- Iris wipes
- Tunnel vision

Examples:
- Camera lens → Eye
- Tunnel → Planet
- Drain → Clock face

### Rectangles
Perfect for:
- Door/window transitions
- Screen replacements
- Frame-in-frame effects
- Dimensional shifts

Examples:
- Door → Computer screen
- Window → Picture frame
- Mirror → Portal

### Arches
Perfect for:
- Gateway effects
- Bridge transitions
- Architectural flow
- Fantasy portals

Examples:
- Archway → Rainbow
- Bridge → Smile curve
- Dome → Umbrella

## Transition Effects

### 1. Direct Portal
Perfect alignment allows straight through:
```javascript
// After Effects expression
position.valueAtTime(time - 1) + 
(targetPosition - sourcePosition) * (time / duration)
```

### 2. Zoom Spiral
For circular portals with rotation:
```javascript
// Combines zoom and rotation
scale * (1 + time * zoomFactor)
rotation + (time * 360)
```

### 3. Portal Wipe
Masked transition between shots:
```javascript
// Mask expands from portal shape
maskPath.valueAtTime(0) * (1 + time / duration)
```

### 4. Dimensional Shift
Portal as gateway between worlds:
- Distortion effects
- Color shifts
- Time displacement

## Practical Workflows

### 1. Planned Portal Shots

When shooting specifically for portals:
1. Frame shapes intentionally
2. Ensure good edge definition
3. Control lighting for contrast
4. Leave space for effect expansion

### 2. Found Portals

Discovering portals in existing footage:
1. Scan for geometric shapes
2. Look for natural frames
3. Consider abstract portals
4. Test multiple combinations

### 3. Creative Combinations

Unexpected portal matches:
- Different shape types can work
- Size differences add dynamics
- Misalignment creates movement
- Color contrast enhances effect

## Advanced Techniques

### Multi-Stage Portals

Chain multiple portals:
```bash
# Analyze sequence
alice transitions portal shot1.jpg shot2.jpg shot3.jpg

# Creates: Portal 1 → Portal 2 → Destination
```

### Portal Enhancement

Improve detected portals:
1. Increase edge contrast in post
2. Darken/lighten portal areas
3. Add geometric shapes
4. Composite portal elements

### Dynamic Portals

Animate portal properties:
- Size changes (growing/shrinking)
- Position shifts (moving portals)
- Shape morphing (circle to square)
- Rotation (spinning portals)

## Export Formats

### After Effects Script (.jsx)

```javascript
// Portal Effect Transition
// Generated by AliceMultiverse

// Portal 1 (Source)
var portal1_center = [0.5, 0.5];
var portal1_size = [0.3, 0.3];
var portal1_type = 'circle';

// Portal 2 (Destination)
var portal2_center = [0.5, 0.5];
var portal2_size = [0.3, 0.3];
var portal2_type = 'circle';

// Transition parameters
var effect_type = 'zoom_spiral';
var duration = 1.0; // seconds

// Apply effect
// 1. Create mask from portal1
// 2. Animate scale and position
// 3. Transition to portal2
```

### JSON Data

```json
{
  "shot1_portals": [
    {
      "type": "circle",
      "center": [0.5, 0.5],
      "size": [0.3, 0.3],
      "quality": 0.89
    }
  ],
  "shot2_portals": [...],
  "best_match": {
    "portal1_index": 0,
    "portal2_index": 0,
    "score": 0.85,
    "transition": "zoom_through"
  },
  "recommended_effect": "zoom_spiral"
}
```

## Integration Examples

### With Match Cuts
```python
# Find portal at match cut point
"Find match cuts, then detect portals at cut points"
```

### With Color Flow
```python
# Portal with color transition
"Detect portals and analyze color compatibility"
```

### With Music Sync
```python
# Time portal effect to beat
"Create portal transition on the drop"
```

## Best Practices

### 1. Portal Selection
- Prioritize clear, well-defined shapes
- Consider narrative relevance
- Match portal types when possible
- Use quality scores as guide

### 2. Effect Timing
- 0.5-2.0 seconds typically works
- Faster for energy, slower for drama
- Match to music/pacing
- Test different durations

### 3. Enhancement Tips
- Add glow to portal edges
- Use depth of field
- Add particle effects
- Consider motion blur

### 4. Common Mistakes
- Forcing portals where none exist
- Ignoring size relationships
- Over-using the effect
- Poor timing choices

## Troubleshooting

### No Portals Detected
- Check image contrast
- Look for shapes manually
- Adjust detection parameters
- Try different shots

### Poor Quality Scores
- Enhance edges in post
- Adjust lighting/exposure
- Create artificial portals
- Composite solutions

### Alignment Issues
- Use reposition effects
- Animate portal movement
- Add intermediate frames
- Creative misalignment

## Creative Ideas

### 1. Time Portals
- Clock face → Watch face
- Calendar → Window
- Hourglass → Doorway

### 2. Dimensional Gates
- Mirror → Lake surface
- Picture frame → Window
- Screen → Reality

### 3. Abstract Portals
- Eye → Flower center
- Mouth → Cave entrance
- Hand gesture → Opening

### 4. Nested Portals
- Portal within portal
- Recursive effects
- Infinite zoom
- Fractal transitions

## CLI Reference

```bash
# Basic usage
alice transitions portal [shot1] [shot2] [options]

# Options
-o, --output    Output file (default: portal_effect.json)
-f, --format    Export format: after_effects, json (default: after_effects)
-v, --verbose   Show detected portals details

# Examples
alice transitions portal door.jpg room.jpg -o portal.jsx
alice transitions portal entrance.jpg exit.jpg -f json -v
alice transitions portal shot1.jpg shot2.jpg -o effect.jsx
```

## Summary

Portal effects in AliceMultiverse enable:
- Automatic shape detection for transitions
- Creative "through the looking glass" effects
- Multiple portal types and matches
- Export to professional software
- Integration with other effects

Key benefits:
- Find hidden transition opportunities
- Create magical, seamless cuts
- Add production value
- Save time in post
- Enhance storytelling

For more details:
- [Match Cuts Guide](match-cuts-guide.md)
- [Color Flow Guide](color-flow-transitions-guide.md)
- [Video Export Guide](video-export-complete-guide.md)